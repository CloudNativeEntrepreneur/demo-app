buildPack: docker-helm
pipelineConfig:
  containerOptions:
    resources:
        limits:
          cpu: 2
          memory: 2Gi
        requests:
          cpu: 2
          memory: 2Gi
  env:
  - name: LOAD_TEST_USERS
    value: '500'
  - name: LOAD_TEST_RAMP_DURATION
    value: 3m
  - name: LOAD_TEST_FULL_LOAD_DURATION
    value: 6m
  - name: MAVEN_OPTS
    value: -Xms256m -Xmx2048m -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn
  - name: _JAVA_OPTIONS
    value: -XX:+UnlockExperimentalVMOptions -Dsun.zip.disableMemoryMapping=true
      -XX:+UseParallelGC -XX:MinHeapFreeRatio=5 -XX:MaxHeapFreeRatio=10
      -XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90 -Xms256m -Xmx2048m
  pipelines:
    pullRequest:
      promote:
        steps:
        - dir: charts/preview
          steps:
          - sh: make preview
            name: preview-setup
          - sh: jx preview --app $APP_NAME --dir ../..
            name: preview
          - sh: PREVIEW_URL=https://$REPO_NAME-jx-$(echo $REPO_OWNER | tr '[:upper:]' '[:lower:]' )-$REPO_NAME-pr-$PULL_NUMBER.cloudnativeentrepreneur.dev sh ./load-test.sh
            name: load-test
