buildPack: docker-helm
pipelineConfig:
  env:
  - name: LOAD_TEST_USERS
    value: '10'
  - name: LOAD_TEST_RAMP_DURATION
    value: 1m
  - name: LOAD_TEST_FULL_LOAD_DURATION
    value: 1m
  - name: PREVIEW_URL
    value: https://$REPO_NAME-jx-$REPO_OWNER-$REPO_NAME-pr-$PULL_NUMBER.cloudnativeentrepreneur.dev
  pipelines:
    pullRequest:
      promote:
        steps:
        - dir: charts/preview
          steps:
          - sh: make preview
            name: preview-setup
          - sh: jx preview --app $APP_NAME --dir ../..
            name: preview
          - sh: sh ./load-test.sh
            name: load-test