buildPack: docker-helm
pipelineConfig:
  env:
  - name: LOAD_TEST_USERS
    value: '500'
  - name: LOAD_TEST_RAMP_DURATION
    value: 3m
  - name: LOAD_TEST_FULL_LOAD_DURATION
    value: 6m
  containerOptions:
    resources:
        limits:
          cpu: 2
          memory: 2Gi
        requests:
          cpu: 2
          memory: 2Gi
  pipelines:
    pullRequest:
      promote:
        steps:
        - dir: charts/preview
          steps:
          - sh: make preview
            name: preview-setup
          - sh: jx preview --app $APP_NAME --dir ../..
            name: preview
          - sh: PREVIEW_URL=https://$REPO_NAME-jx-$(echo $REPO_OWNER | tr '[:upper:]' '[:lower:]' )-$REPO_NAME-pr-$PULL_NUMBER.cloudnativeentrepreneur.dev sh ./load-test.sh
            name: load-test